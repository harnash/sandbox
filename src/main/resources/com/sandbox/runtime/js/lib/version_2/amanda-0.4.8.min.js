//had to change the validate() to take a string, and the callback to put out a string, because of ScriptObjectMirror.
!function(){var t={},r=function(t){return typeof t},e=function(t,r,e){var n=function(t,r){if(a(t)&&!s(t))for(var e=0,n=t.length;n>e;e++)r.apply(t,[e,t[e]])
if(l(t)&&!s(t))for(var i in t)t.hasOwnProperty(i)&&r.apply(t,[i,t[i]])},i=function(t,r,e){var n=0,i=0,o=!1,u=!1,p=function(){return u&&n==i?e():void 0},d=function(t,a){var u=function(t){return o?void 0:t?(o=!0,e(t)):(n++,p())}
return i++,r(t,a,u)}
if(a(t)&&!s(t))for(var f=0,c=t.length;c>f;f++)d(f,t[f])
else{if(!l(t)||s(t))return e()
for(var h in t)t.hasOwnProperty(h)&&d(h,t[h])}return u=!0,p()}
return"undefined"==typeof e?n.apply(this,arguments):i.apply(this,arguments)},n=function(t,r){return Array.prototype.every.apply(t,[r])},i=function(t,r,e){return Array.prototype.filter.apply(t,[r,e||this])},o=function(t,r){return Object.prototype.hasOwnProperty.apply(t,[r])},a=function(t){return"[object Array]"===Object.prototype.toString.call(t)},u=function(t){return"boolean"==typeof t},p=function(t){return"undefined"!=typeof t},s=function(t){if(y(t))return!1
if(null===t)return!0
if(a(t)||"string"==typeof t)return 0===t.length
if(l(t))for(var r in t)if(hasOwnProperty.call(t,r))return!1
return!0},d=function(t,r){if(a(t,r))return t.length!==r.length?!1:n(t,function(t,e){return r[e]===t})
if(l(t,r)){var e=b(t),i=b(r)
if(!d(e,i))return!1
for(key in t)if(!r[key]||t[key]!==r[key])return!1
return!0}return!1},f=function(t){return"function"==typeof t},c=function(t){return y(t)&&t%1===0},h=function(t){return null===t},y=function(t){return"number"==typeof t},l=function(t){return"[object Object]"===Object.prototype.toString.call(t)},m=function(t){return"string"==typeof t},v=function(t){return"undefined"==typeof t},b=function(t){return Object.keys(t)},g=function(t,r){for(var e in r)r.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=r[e])
return t},A=function(t,r){for(var e=[],n=0,i=t.length;i>n;n++){var o=t[n][r];-1===e.indexOf(o)&&e.push(o)}return e},j=function(){return!0}
!function(){var E=function(t){var r=this,n={singleError:!0,messages:J,cache:!1}
e(n,function(e,i){r[e]=l(i)&&t[e]?g(t[e],n[e]):l(i)&&!t[e]?g({},n[e]):p(t[e])?t[e]:n[e]}),this.errors=new k(this)}
E.prototype.attributes={},E.prototype.addAttribute=function(t,r){return E.prototype.attributes[t]=r},E.prototype.addAttributeConstructor=function(t,r){return E.prototype.attributes[t]=r()}
var P=function(t,r,n,o,a){var u=this
if(n===!0)return a()
var p=b(r),d=i(p,function(t){return!o.properties[t]})
return s(d)?a():n===!1?(d.forEach(function(e){this.addError({property:this.joinPath(t,e),propertyValue:r[e]})},this),a()):l(n)?e(d,function(e,i,o){return u.validateSchema(r[i],n,t+i,o)},a):void 0}
E.prototype.addAttribute("additionalProperties",P)
var x=function(t,r,e,n,i){return 0===e?(this.addError("The value of this attribute should not be 0."),i()):(y(r)&&r%e!==0&&this.addError(),i())}
E.prototype.addAttribute("divisibleBy",x)
var O=function(t,r,e,n,i){return-1===e.indexOf(r)&&this.addError(),i()}
E.prototype.addAttribute("enum",O)
var w=function(t,r,e,n,i){return-1!==e.indexOf(r)&&this.addError(),i()}
E.prototype.addAttribute("except",w),E.prototype.addAttributeConstructor("format",function(){var t={"date-time":{type:"string",pattern:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-[0-9]{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/},date:function(t){return m(t)?t.match(/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-[0-9]{2}$/):"[object Date]"===Object.prototype.toString.call(t)},time:{type:"string",pattern:/^\d{2}:\d{2}:\d{2}$/},"utc-milisec":{type:"number"},regex:function(t){return t&&t.test&&t.exec},color:{type:"string"},style:{type:"string"},phone:{type:"number"},uri:{type:"string",pattern:/^(?:(?:ht|f)tp(?:s?)\:\/\/|~\/|\/)?(?:\w+:\w+@)?((?:(?:[-\w\d{1-3}]+\.)+(?:com|org|cat|coop|int|pro|tel|xxx|net|gov|mil|biz|info|mobi|name|aero|jobs|edu|co\.uk|ac\.uk|it|fr|tv|museum|asia|local|travel|[a-z]{2})?)|((\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)(\.(\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)){3}))(?::[\d]{1,5})?(?:(?:(?:\/(?:[-\w~!$+|.,=]|%[a-f\d]{2})+)+|\/)+|\?|#)?(?:(?:\?(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)(?:&(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)*)*(?:#(?:[-\w~!$ |\/.,*:;=]|%[a-f\d]{2})*)?$/},email:{type:"string",pattern:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/},"ip-address":{type:"string",pattern:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/},ipv6:{type:"string",pattern:/(?:(?:[a-f\d]{1,4}:)*(?:[a-f\d]{1,4}|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(?:(?:[a-f\d]{1,4}:)*[a-f\d]{1,4})?::(?:(?:[a-f\d]{1,4}:)*(?:[a-f\d]{1,4}|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}))?)/},"host-name":{type:"string"}}
t.alpha={required:!0,type:"string",pattern:/^[a-zA-Z]+$/},t.alphanumeric={required:!0,type:["string","number"],pattern:/^[a-zA-Z0-9]+$/},t.decimal=function(t){return y(t)?(t+"").match(/^[0-9]+(\.[0-9]{1,2})?$/):!1},t.percentage={required:!0,type:["string","number"],pattern:/^-?[0-9]{0,2}(\.[0-9]{1,2})?$|^-?(100)(\.[0]{1,2})?$/,minimum:-100,maximum:100},t.port={required:!0,type:["string","number"],pattern:/\:\d+/}
var r={url:"uri",ip:"ip-address",ipv4:"ip-address",host:"host-name",hostName:"host-name"}
return e(r,function(r,e){t[r]=t[e]}),function(r,e,n,i,a){if(l(n))return this.validateProperty(r,e,n,a)
if(m(n)&&!o(t,n))return this.addError("The format ‘"+n+"’ is not supported."),a()
if(m(n)){var u=t[n]
if(f(u)){var p=u(e)
return p||this.addError(),a()}if(l(u))return this.validateProperty(r,e,u,a)}}})
var T=function(t,r,e,n,i){return m(r)&&r.length!==e&&this.addError(),i()}
E.prototype.addAttribute("length",T)
var V=function(t,r,e,n,i){return y(r)&&(n.exclusiveMaximum&&r>=e||r>e)&&this.addError(),i()}
E.prototype.addAttribute("maximum",V)
var S=function(t,r,e,n,i){return a(r)&&r.length>e&&this.addError(),i()}
E.prototype.addAttribute("maxItems",S)
var $=function(t,r,e,n,i){return m(r)&&r.length>e&&this.addError(),i()}
E.prototype.addAttribute("maxLength",$)
var N=function(t,r,e,n,i){return y(r)&&(n.exclusiveMinimum&&e>=r||e>r)&&this.addError(),i()}
E.prototype.addAttribute("minimum",N)
var I=function(t,r,e,n,i){return a(r)&&r.length<e&&this.addError(),i()}
E.prototype.addAttribute("minItems",I)
var q=function(t,r,e,n,i){return m(r)&&r.length<e&&this.addError(),i()}
E.prototype.addAttribute("minLength",q)
var z=function(t,r,e,n,i){return m(r)&&!r.match(e)&&this.addError(),i()}
E.prototype.addAttribute("pattern",z),function(){var t=function(t,r,n,i,o){var a=this
if(s(n))return o()
var u={},p=b(n)
return e(r,function(t){e(p,function(r,e){t.match(new RegExp(e))&&(u[t]=n[e])})}),s(u)?o():void e(u,function(e,n,i){return a.validateSchema(r[e],n,a.joinPath(t,e),i)},o)}
E.prototype.addAttribute("patternProperties",t)}()
var C=function(t,r,e,n,i){if(e){var o=v(r)
o&&this.addError()}return i()}
E.prototype.addAttribute("required",C)
var Z=function(){var t={string:m,number:y,"function":f,"boolean":u,object:l,array:a,integer:c,"int":c,"null":h,any:j}
return function(r,e,i,u,p){if(a(i)){var s
if(s=n(i,function(r){return o(t,r)}),!s)return this.addError("One of the following types ‘"+i.join(",")+"’ is not supported."),p()
var d=i.some(function(r){return t[r](e)})
return d||this.addError(),p()}if(o(t,i)){var f=t[i](e)
f||this.addError()}else this.addError("Type ‘"+i+"’ is not supported.")
return p()}}
E.prototype.addAttributeConstructor("type",Z),function(){var t=function(t,r,n,i,o){var u=this
return e(r,function(e,n){m(n)&&r.indexOf(n)<e&&u.addError(),(l(n)||a(n))&&r.forEach(function(r,i){i!==e&&d(n,r)&&u.addError({property:u.joinPath(t,i)})})}),o()}
E.prototype.addAttribute("uniqueItems",t)}()
var k=function(t){this.length=0,this.errorMessages=t.messages}
k.prototype.renderErrorMessage=function(t){var r=this.errorMessages[t.attributeName]
return r&&f(r)?r(t.property,t.propertyValue,t.attributeValue):r&&m(r)?(["property","propertyValue","attributeValue"].forEach(function(e){r=r.replace(new RegExp("{{"+e+"}}","g"),t[e])}),r=r.replace(/{{validator}}/g,t.attributeValue),r.replace(/\s+/g," ")):t.message},k.prototype.push=function(t){this[this.length]={property:t.property,propertyValue:t.propertyValue,attributeName:t.attributeName,attributeValue:t.attributeValue,message:this.renderErrorMessage(t),validator:t.attributeName,validatorName:t.attributeName,validatorValue:t.attributeValue},this.length+=1},k.prototype.getProperties=function(){return A(this,"property")},k.prototype.getMessages=function(){return A(this,"message")}
var M="aeiou",J={required:function(t){return"The ‘"+t+"’ property is required."},minLength:function(t,r,e){return["The "+t+" property must be at least "+e+" characters.","The length of the property is "+r.length+"."].join(" ")},maxLength:function(t,r,e){return["The "+t+" property must not exceed "+e+" character"+(e>1?"s":"")+".","The length of the property is "+r.length+"."].join(" ")},length:function(t,r,e){return["The "+t+" property must be exactly "+e+" character"+(e>1?"s":"")+".","The length of the property is "+r.length+"."].join(" ")},format:function(t,r,e){return["The ‘"+t+"’ property must be a/an ‘"+e+"’.","The current value of the property is ‘"+r+"’"].join(" ")},type:function(t,e,n){return["The ‘"+t+"’ property must be "+(M.indexOf(n[0])>-1?"an":"a")+" ‘"+n+"’.","The type of the property is ‘"+r(e)+"’"].join(" ")},except:function(){},minimum:function(t,r,e){return["The minimum value of the ‘"+t+"’ must be "+e+".","The current value of the property is ‘"+r+"’"].join(" ")},maximum:function(t,r,e){return["The maximum value of the ‘"+t+"’ must be "+e+".","The current value of the property is ‘"+r+"’."].join(" ")},pattern:function(t,r,e){return"The ‘"+t+"’ does not match the ‘"+e+"’ pattern."},maxItems:function(t,r,e){return["The ‘"+t+"’ property must not contain more than ‘"+e+"’ items.","Currently it contains ‘"+r.items+"’ items."].join(" ")},minItems:function(t,r,e){return["The ‘"+t+"’ property must contain at least ‘"+e+"’ items.","Currently it contains ‘"+r.items+"’ items."].join(" ")},divisibleBy:function(t,r,e){return"The ‘"+t+"’ is not divisible by ‘"+e+"’."},uniqueItems:function(t){return"All items in the ‘"+t+"’ property must be unique."},"enum":function(t,r,e){return"Value of the ‘"+t+"’ must be "+e.join(" or ")+"."}}
E.prototype.getProperty=function(t,r){return r&&p(r[t])?r[t]:void 0},E.prototype.joinPath=function(t,r){return t=t||[],t=JSON.parse(JSON.stringify(t)),r+="",t.push(r),t},E.prototype.validate=function(t,r,e){var n=this
this.instance=t,this.schema=r
var i=["string","number","function","boolean","integer","int","null"],o=["object","array"],u=function(){var t=n.errors
return 0!==n.errors.length?e(t):e()}
if(-1!==i.indexOf(r.type))return this.validateProperty(void 0,t,r,u)
if(-1!==o.indexOf(r.type)){if(m(t))try{t=JSON.parse(t)}catch(p){}return this.validateSchema(t,r,"",u)}if("any"===r.type||!r.type){if(m(t))try{return t=JSON.parse(t),this.validateSchema(t,r,"",u)}catch(s){}return l(t)||a(t)?this.validateSchema(t,r,"",u):this.validateProperty(void 0,t,r,u)}},E.prototype.validateItems=function(t,r,n,i){var o=this
return v(t)&&(t=[]),a(r.items)?v(r.additionalItems)||r.additionalItems===!0?e(r.items,function(r,e,i){return o.validateSchema(t[r],e,o.joinPath(n,r),i)},i):e(t,function(t,e,i){return r.items[t]||l(r.additionalItems)?o.validateSchema(e,r.items[t],o.joinPath(n,t),i):r.additionalItems===!1?(o.errors.push({property:o.joinPath(n,t),propertyValue:e,attributeName:"additionalItems",attributeValue:!1}),i()):void 0},i):l(r.items)&&t&&!s(t)?e(t,function(e,i,a){return o.validateSchema(t[e],r.items,o.joinPath(n,e),a)},i):i()},E.prototype.validateProperties=function(t,r,n,i){var o=this
return e(r.properties,function(e,i,a){var u="object"===i.type&&i.properties,p="array"===i.type,s=o.getProperty(e,t),d=o.joinPath(n,e)
return u||p?o.validateSchema(s,r.properties[e],d,a):o.validateProperty(d,s,i,a)},i)},E.prototype.validateProperty=function(t,r,n,i){var o=this,a={};["validateItems","validateProperties","validateSchema","validateProperty","getProperty","attributes","errors","joinPath"].forEach(function(t){a[t]=this[t]},o)
var u=function(e,i,u){var s=o.errors.length
a.addError=function(i){return l(i)?(t=i.property||t,Array.isArray(t)||(t=[t]),o.errors.push({property:t,propertyValue:i.propertyValue||r,attributeName:i.attributeName||e,attributeValue:i.attributeValue||n[e],message:i.message||void 0})):(Array.isArray(t)||(t=[t]),o.errors.push({property:t,propertyValue:r,attributeName:e,attributeValue:n[e],message:i}))}
var d=function(t){return t===!0||m(t)?(a.addError(t),u(!0)):o.errors.length>s&&o.singleError?u(!0):u()}
return p(n[e])?i.apply(a,[t,r,n[e],n,d]):u()}
return n.required!==!0&&v(r)?i():e(o.attributes,u,i)},E.prototype.validateSchema=function(t,r,e,n){var i=this
return i.validateProperty(e,t,r,function(){return r.properties?i.validateProperties(t,r,e,n):r.items?i.validateItems(t,r,e,n):n()})},t.json=function(){return{validate:function(t,r,e,n){return"function"==typeof e&&(n=e,e={}),m(r)&&(r=JSON.parse(r)),new E(e).validate(t,r,n)},addAttribute:function(){return E.prototype.addAttribute.apply(E,arguments)},addAttributeConstructor:function(){return E.prototype.addAttributeConstructor.apply(E,arguments)}}}()}()
var E=function(r){if(!o(t,r))throw new Error("The ‘"+r+"’ engine is not supported. Please use a different one.")
return t[r]}
E.validate=function(){var r=t.json
return r.validate.apply(r,arguments)},E.addValidator=function(){var r=t.json
return r.addAttribute.apply(r,arguments)},E.addAttribute=function(){var r=t.json
return r.addAttribute.apply(r,arguments)},E.addAttributeConstructor=function(){var r=t.json
return r.addAttributeConstructor.apply(r,arguments)},"undefined"!=typeof module&&module.exports?module.exports=E:"undefined"!=typeof define?define(function(){return E}):this.amanda=E}()
